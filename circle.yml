machine:
  xcode:
    version: 9.0
  environment:
    UNITY_HOME: /Applications/Unity
    LC_ALL: en_US.UTF-8
    LANG: en_US.UTF-8
test:
  override:
    - rake package:download package:import config:all build:android
dependencies:
  pre:
    - gem install bundler
    - bundle install
    - ./setup
    - bundle exec fastlane match development
    - openssl enc -d -aes-256-cbc -in kms/Unity_lic.ulf.data -out /Library/Application\ Support/Unity/Unity_lic.ulf -k `aws kms decrypt --ciphertext-blob fileb://kms/store_encryption_key.key --output text --query Plaintext | base64 --decode`
  cache_directories:
    - ~/Library/Caches/Homebrew/
checkout:
  post:
    - git fetch --tags
deployment:
  prod:
    branch: [master]
    commands:
      - aws s3 cp teak-unity-cleanroom.ipa s3://teak-build-artifacts/unity-cleanroom/teak-unity-cleanroom.ipa --acl public-read
